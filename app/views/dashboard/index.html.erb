<style>
  /* --- –ì–ª–æ–±–∞–ª—å–Ω—ñ —Å—Ç–∏–ª—ñ --- */
  .cabinet-container { display: flex; background-color: #f4f4f4; min-height: 100vh; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
  .sidebar { width: 260px; background-color: #1a1a1a; color: #fff; display: flex; flex-direction: column; padding-top: 20px; }
  .sidebar button { background: none; border: none; color: #b0b0b0; padding: 15px 25px; text-align: left; font-size: 16px; cursor: pointer; transition: 0.2s; border-left: 4px solid transparent; width: 100%; }
  .sidebar button:hover { background-color: #2a2a2a; color: white; }
  .sidebar button.active { background-color: #2a2a2a; color: white; border-left: 4px solid #e74c3c; font-weight: bold; }
  .content-area { flex: 1; padding: 40px; }
  
  /* –°—Ç–∏–ª—ñ —Ñ–æ—Ä–º */
  .edit-profile-form { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); max-width: 900px; }
  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 30px; }
  .input-group { margin-bottom: 20px; position: relative; }
  .input-group label { display: block; font-size: 13px; color: #555; margin-bottom: 8px; font-weight: 600; }
  .styled-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; background-color: #fafafa; box-sizing: border-box; }
  .split-row { display: flex; gap: 20px; margin-bottom: 20px; }
  .split-row .input-group { flex: 1; margin-bottom: 0; }
  .btn-save { background-color: #000; color: white; padding: 15px 40px; border: none; border-radius: 6px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 20px; }
  
  /* –°—Ç–∏–ª—ñ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ñ */
  .data-table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px; overflow: hidden; margin-top: 20px; }
  .data-table th { background-color: #333; color: white; padding: 15px; text-align: left; font-size: 14px; }
  .data-table td { padding: 12px 15px; border-bottom: 1px solid #eee; font-size: 13px; color: #333; vertical-align: middle; }
  .data-table tr:hover { background-color: #f9f9f9; }
  
  /* –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å */
  .admin-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
  .admin-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); text-align: center; border: 1px solid #eee; text-decoration: none; color: #333; display: block; transition: 0.3s; position: relative; overflow: hidden; cursor: pointer; }
  .admin-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
  .admin-icon { font-size: 28px; margin-bottom: 10px; display: block; }
  .card-count { font-size: 24px; font-weight: bold; display: block; margin: 5px 0; }
  .card-label { font-size: 12px; color: #777; text-transform: uppercase; letter-spacing: 1px; }
  
  /* –ö–æ–ª—å–æ—Ä–æ–≤—ñ –∞–∫—Ü–µ–Ω—Ç–∏ –¥–ª—è –∫–∞—Ä—Ç–æ–∫ */
  .card-new { border-bottom: 4px solid #ffc107; }
  .card-process { border-bottom: 4px solid #17a2b8; }
  .card-done { border-bottom: 4px solid #28a745; }
  .card-products { border-bottom: 4px solid #6c757d; }
  .card-finance { border-bottom: 4px solid #4cd137; } 
  .card-reviews { border-bottom: 4px solid #9b59b6; }
  
  /* –§—ñ–Ω–∞–Ω—Å–æ–≤—ñ –∫–∞—Ä—Ç–∫–∏ */
  .finance-card { background: linear-gradient(135deg, #11998e, #38ef7d); color: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 20px rgba(17, 153, 142, 0.3); text-align: left; position: relative; overflow: hidden; }
  .finance-card h3 { margin: 0; font-size: 14px; text-transform: uppercase; opacity: 0.8; letter-spacing: 1px; }
  .finance-card .money { font-size: 36px; font-weight: bold; margin-top: 10px; }
  .finance-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; margin-bottom: 40px; }
  
  /* –í–∫–ª–∞–¥–∫–∏ */
  .tab-content { display: none; }
  .tab-content.active { display: block; animation: fadeIn 0.3s; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  
  /* –ü—ñ–¥–∫–∞–∑–∫–∏ */
  .suggestions-list { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #ddd; max-height: 250px; overflow-y: auto; z-index: 1000; display: none; }
  .suggestions-list li { padding: 12px; cursor: pointer; border-bottom: 1px solid #f0f0f0; list-style: none; }
  .suggestions-list li:hover { background-color: #f9f9f9; }
  
  /* –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ */
  .btn-back { background: #333; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; font-size: 14px; text-decoration: none; }
  .btn-back:hover { background: #555; }

  /* –°—Ç–∏–ª—ñ –¥–ª—è –∑—ñ—Ä–æ—á–æ–∫ */
  .star-rating input:checked ~ label,
  .star-rating label:hover,
  .star-rating label:hover ~ label {
    color: #ffc107 !important;
  }
</style>
  
<div class="cabinet-container">
    
  <div class="sidebar">
    <div style="padding: 0 25px 20px;">
      <h2 style="color: white; border: none; margin: 0;">–ú—ñ–π –∞–∫–∞—É–Ω—Ç</h2>
    </div>
    <button onclick="openTab('profile')" class="tab-btn active" id="btn-profile">üë§ –û—Å–æ–±–∏—Å—Ç—ñ –¥–∞–Ω—ñ</button>
    <button onclick="openTab('orders')" class="tab-btn" id="btn-orders">üì¶ –ú–æ—ó –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
    <button onclick="openTab('favorites')" class="tab-btn" id="btn-favorites">‚ù§Ô∏è –û–±—Ä–∞–Ω–µ</button>
  
    <% if current_user.admin? %>
      <hr style="border-color: #333; width: 80%; margin: 15px auto;">
      <button onclick="openTab('admin-panel')" class="tab-btn" id="btn-admin-panel" style="color: #ff6b6b;">üõ† –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</button>
    <% end %>
    
    <div style="margin-top: auto; padding: 20px;">
      <%= button_to "–í–∏—Ö—ñ–¥", destroy_user_session_path, method: :delete, style: "color: #777; font-size: 14px; padding: 0; background: none; border: none; cursor: pointer;" %>
    </div>
  </div>
  
  <div class="content-area">
      
    <div id="profile" class="tab-content active">
      <div class="edit-profile-form">
        <h2 style="margin-top: 0; margin-bottom: 25px;">–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é</h2>
        <%= form_for(current_user, url: registration_path(current_user), html: { method: :put }) do |f| %>
          <div class="form-grid">
            <div>
              <h3 style="color: #777; font-size: 14px; margin-bottom: 15px;">–ö–û–ù–¢–ê–ö–¢–ù–ê –Ü–ù–§–û–†–ú–ê–¶–Ü–Ø</h3>
              <div class="input-group"><label>–Ü–º'—è</label><%= f.text_field :first_name, class: "styled-input" %></div>
              <div class="input-group"><label>–ü—Ä—ñ–∑–≤–∏—â–µ</label><%= f.text_field :last_name, class: "styled-input" %></div>
              <div class="input-group"><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><%= f.text_field :phone_number, class: "styled-input" %></div>
              <div class="input-group"><label>Email</label><%= f.email_field :email, class: "styled-input" %></div>
            </div>
            <div>
              <h3 style="color: #777; font-size: 14px; margin-bottom: 15px;">–ê–î–†–ï–°–ê –î–û–°–¢–ê–í–ö–ò</h3>
              <div class="input-group">
                  <label>–ú—ñ—Å—Ç–æ / –°–µ–ª–æ</label>
                  <%= f.text_field :city, class: "styled-input", id: "city-search", placeholder: "–ü–æ—á–Ω—ñ—Ç—å –≤–≤–æ–¥–∏—Ç–∏ –Ω–∞–∑–≤—É...", autocomplete: "off" %>
                  <ul id="city-suggestions" class="suggestions-list"></ul>
              </div>
              <div class="input-group"><label>–í—É–ª–∏—Ü—è</label><%= f.text_field :street, class: "styled-input" %></div>
              <div class="split-row">
                  <div class="input-group"><label>–ë—É–¥–∏–Ω–æ–∫</label><%= f.text_field :house_number, class: "styled-input" %></div>
                  <div class="input-group"><label>–ö–≤–∞—Ä—Ç–∏—Ä–∞</label><%= f.text_field :apartment, class: "styled-input" %></div>
              </div>
              <div class="split-row">
                  <div class="input-group"><label>–ü—ñ–¥'—ó–∑–¥</label><%= f.text_field :entrance, class: "styled-input" %></div>
                  <div class="input-group"><label>–ü–æ–≤–µ—Ä—Ö</label><%= f.text_field :floor, class: "styled-input" %></div>
              </div>
            </div>
          </div>
          <div style="background: #fff3cd; padding: 15px; border-radius: 6px; color: #856404; margin-bottom: 20px;">
            <label style="font-weight: bold; display: block; margin-bottom: 5px;">üîë –ü–æ—Ç–æ—á–Ω–∏–π –ø–∞—Ä–æ–ª—å</label>
            <%= f.password_field :current_password, class: "styled-input", style: "background: white;" %>
          </div>
          <%= f.submit "–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏", class: "btn-save" %>
        <% end %>
      </div>
    </div>
  
    <div id="orders" class="tab-content">
      <h2>üì¶ –Ü—Å—Ç–æ—Ä—ñ—è –∑–∞–º–æ–≤–ª–µ–Ω—å</h2>
      <% if @orders.any? %>
          <table class="data-table">
            <thead>
              <tr>
                <th>‚Ññ</th>
                <th>–î–∞—Ç–∞</th>
                <th>–°—É–º–∞</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–û—Ü—ñ–Ω–∫–∞</th> 
              </tr>
            </thead>
            <tbody>
              <% @orders.each do |order| %>
                <tr>
                  <td>#<%= order.id %></td>
                  <td><%= order.created_at.strftime("%d.%m.%Y") %></td>
                  <td><%= order.total_price %> ‚Ç¥</td>
                  <td>
                    <span style="padding: 5px 10px; border-radius: 10px; font-size: 12px; background: #eee; margin-right: 10px;">
                      <%= order.status %>
                    </span>

                    <% if order.status == "–ù–æ–≤–µ" %>
                      <%= link_to "‚úèÔ∏è", edit_order_path(order), title: "–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è", style: "text-decoration: none; font-size: 16px; background: #fff3cd; padding: 4px 8px; border-radius: 4px; border: 1px solid #ffeeba;" %>
                    <% end %>
                  </td>
                  
                  <td>
                    <% if order.rating.present? %>
                      <div style="color: #ffc107; font-size: 18px;">
                        <% order.rating.times do %>‚òÖ<% end %><% (5 - order.rating).times do %>‚òÜ<% end %>
                      </div>
                    <% else %>
                      <% if ['–í–∏–∫–æ–Ω–∞–Ω–æ', '–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ'].include?(order.status) %>
                        <button onclick="openReviewModal('<%= order.id %>')" style="background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                          ‚≠ê –û—Ü—ñ–Ω–∏—Ç–∏
                        </button>
                      <% elsif order.status == "–ù–æ–≤–µ" %>
                         <span style="color: #28a745; font-size: 12px;">–ú–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ –¥–∞–Ω—ñ</span>
                      <% else %>
                        <span style="color: #999; font-size: 12px;">–û—á—ñ–∫—É—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è</span>
                      <% end %>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
      <% else %>
        <p style="padding: 20px; background: white; border-radius: 8px;">–Ü—Å—Ç–æ—Ä—ñ—è –ø–æ—Ä–æ–∂–Ω—è.</p>
      <% end %>
    </div>
  
    <div id="favorites" class="tab-content">
      <h2>‚ù§Ô∏è –û–±—Ä–∞–Ω—ñ —Ç–æ–≤–∞—Ä–∏</h2>
      <% if @favorites.any? %>
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
          <% @favorites.each do |product| %>
            <div style="background: white; border: 1px solid #eee; border-radius: 8px; padding: 15px; text-align: center;">
                <div style="height: 180px; width: 100%; background: #f9f9f9; border-radius: 4px; overflow: hidden; position: relative; margin-bottom: 10px;">
                <% if product.images.attached? %>
                  <%= image_tag product.images[0], style: "width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0;" %>
                <% else %>
                  <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 30px;">üì∑</div>
                <% end %>
              </div>
              <div style="font-weight: bold; margin: 10px 0;"><%= link_to product.name, product_path(product), style: "color: #333; text-decoration: none;" %></div>
              <div style="color: #28a745; font-weight: bold; margin-bottom: 10px;"><%= product.price %> ‚Ç¥</div>
              <div style="display: flex; gap: 5px; justify-content: center;">
                <%= button_to "–í –∫–æ—à–∏–∫", cart_items_path(product_id: product.id), style: "background: black; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; font-size: 12px;" %>
                <%= button_to "–í–∏–¥–∞–ª–∏—Ç–∏", product_favorites_path(product), method: :delete, style: "background: #ffebee; color: #d32f2f; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; font-size: 12px;" %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p style="padding: 20px; background: white; border-radius: 8px;">–°–ø–∏—Å–æ–∫ –æ–±—Ä–∞–Ω–æ–≥–æ –ø–æ—Ä–æ–∂–Ω—ñ–π.</p>
      <% end %>
    </div>
  
    <% if current_user.admin? %>
      <div id="admin-panel" class="tab-content">
        <h2 style="color: #d32f2f; margin-bottom: 30px;">–ü–∞–Ω–µ–ª—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
        
        <div class="admin-grid">
          <%= link_to products_path, class: "admin-card card-products" do %>
            <div class="admin-icon">üì¶</div>
            <span class="card-count"><%= Product.count rescue 0 %></span>
            <span class="card-label">–¢–æ–≤–∞—Ä—ñ–≤</span>
          <% end %>

          <div class="admin-card card-finance" onclick="openTab('finance')">
            <div class="admin-icon" style="color: #4cd137;">üìà</div>
            <span class="card-count" style="color: #333;">–§—ñ–Ω–∞–Ω—Å–∏</span>
            <span class="card-label">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Ö–æ–¥—ñ–≤</span>
          </div>
          
          <div class="admin-card card-reviews" onclick="openTab('reviews')">
            <div class="admin-icon" style="color: #9b59b6;">‚≠ê</div>
            <span class="card-count"><%= @reviews_count %></span>
            <span class="card-label">–û—Ü—ñ–Ω–æ–∫ –º–∞–≥–∞–∑–∏–Ω—É</span>
          </div>
          
          <div class="admin-card card-new">
            <div class="admin-icon" style="color: #ffc107;">üî•</div>
            <span class="card-count"><%= @new_orders_count %></span>
            <span class="card-label">–ù–æ–≤—ñ</span>
          </div>
          <div class="admin-card card-process">
            <div class="admin-icon" style="color: #17a2b8;">‚öôÔ∏è</div>
            <span class="card-count"><%= @processing_count %></span>
            <span class="card-label">–í –æ–±—Ä–æ–±—Ü—ñ</span>
          </div>
          <div class="admin-card card-done">
            <div class="admin-icon" style="color: #28a745;">‚úÖ</div>
            <span class="card-count"><%= @done_count %></span>
            <span class="card-label">–í–∏–∫–æ–Ω–∞–Ω—ñ</span>
          </div>
        </div>
        
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 40px; border-bottom: 2px solid #ddd; padding-bottom: 10px;">
            <h3 style="margin: 0;">üìã –°–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å</h3>
        </div>
  
        <% if @admin_orders.any? %>
          <div style="overflow-x: auto;">
            <table class="data-table">
              <thead>
                <tr>
                  <th>‚Ññ</th>
                  <th>–î–∞—Ç–∞</th>
                  <th>–ö–ª—ñ—î–Ω—Ç</th>
                  <th>–°—Ç–∞—Ç—É—Å</th>
                  <th style="text-align: right;">–î—ñ—ó</th>
                </tr>
              </thead>
              <tbody>
                <% @admin_orders.each do |order| %>
                  <tr>
                    <td style="font-weight: bold;">#<%= order.id %></td>
                    <td style="color: #666;"><%= order.created_at.strftime("%d.%m %H:%M") %></td>
                    <td><%= order.user ? "#{order.user.first_name} #{order.user.last_name}" : "–ì—ñ—Å—Ç—å" %></td>
                    <td>
                      <%= form_with url: order_path(order), method: :patch, local: true do |f| %>
                        <%= f.select :status, 
                            options_for_select(["–ù–æ–≤–µ", "–í –æ–±—Ä–æ–±—Ü—ñ", "–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ", "–í–∏–∫–æ–Ω–∞–Ω–æ", "–°–∫–∞—Å–æ–≤–∞–Ω–æ"], order.status), 
                            {}, 
                            { onchange: "this.form.submit()", style: "padding: 5px; border-radius: 4px; border: 1px solid #ddd; cursor: pointer;" } 
                        %>
                      <% end %>
                    </td>
                    <td style="text-align: right;">
                      <%= link_to "–î–µ—Ç–∞–ª—ñ", order, style: "color: #007bff; text-decoration: none; font-weight: bold;" %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% else %>
          <p style="padding: 20px; text-align: center; background: white; margin-top: 20px;">–ó–∞–º–æ–≤–ª–µ–Ω—å –ø–æ–∫–∏ –Ω–µ–º–∞—î.</p>
        <% end %>

        <div style="margin-top: 30px;">
          <%= link_to "+ –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π —Ç–æ–≤–∞—Ä", new_product_path, class: "btn-save", style: "text-decoration: none; display: inline-block; background-color: #28a745;" %>
        </div>
      </div>
  
      <div id="finance" class="tab-content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
          <h2 style="color: #4cd137; margin: 0;">üí∞ –§—ñ–Ω–∞–Ω—Å–æ–≤–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
          <button onclick="openTab('admin-panel')" class="btn-back">‚¨Ö –ù–∞–∑–∞–¥ –¥–æ –ø–∞–Ω–µ–ª—ñ</button>
        </div>
        
        <div class="finance-grid">
          <div class="finance-card">
            <h3>–ó–∞–≥–∞–ª—å–Ω–∏–π –¥–æ—Ö—ñ–¥ (–û—Ç–æ–≤–∞—Ä–µ–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è)</h3>
            <div class="money"><%= number_to_currency(@total_revenue, unit: "‚Ç¥", format: "%n %u", precision: 0) %></div>
            <div style="font-size: 12px; margin-top: 10px; opacity: 0.8;">–õ–∏—à–µ —Å—Ç–∞—Ç—É—Å–∏ "–í–∏–∫–æ–Ω–∞–Ω–æ" —Ç–∞ "–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ"</div>
            <div style="position: absolute; right: 20px; bottom: 10px; font-size: 80px; opacity: 0.2;">üìà</div>
          </div>

          <div class="finance-card" style="background: linear-gradient(135deg, #2b5876, #4e4376);">
            <h3>–°–µ—Ä–µ–¥–Ω—ñ–π —á–µ–∫</h3>
            <div class="money"><%= number_to_currency(@average_check, unit: "‚Ç¥", format: "%n %u", precision: 0) %></div>
              <div style="position: absolute; right: 20px; bottom: 10px; font-size: 60px; opacity: 0.2;">üè∑Ô∏è</div>
          </div>
        </div>

        <h3>üì¶ –û—Ç–æ–≤–∞—Ä–µ–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è (–Ü—Å—Ç–æ—Ä—ñ—è –¥–æ—Ö–æ–¥—É)</h3>
        <% if @admin_orders.where(status: ['–í–∏–∫–æ–Ω–∞–Ω–æ', '–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ']).any? %>
          <table class="data-table">
            <thead>
              <tr>
                <th>‚Ññ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</th>
                <th>–î–∞—Ç–∞</th>
                <th>–ö–ª—ñ—î–Ω—Ç</th>
                <th style="text-align: right;">–°—É–º–∞</th>
              </tr>
            </thead>
            <tbody>
              <% @admin_orders.where(status: ['–í–∏–∫–æ–Ω–∞–Ω–æ', '–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ']).each do |order| %>
                <tr>
                  <td>#<%= order.id %></td>
                  <td><%= order.created_at.strftime("%d.%m.%Y") %></td>
                  <td><%= order.user&.first_name %> <%= order.user&.last_name %></td>
                  <td style="text-align: right; font-weight: bold; color: #28a745;">
                    +<%= order.total_price.to_i %> ‚Ç¥
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        <% else %>
          <p style="padding: 20px; background: white; border-radius: 8px;">–©–µ –Ω–µ–º–∞—î –≤–∏–∫–æ–Ω–∞–Ω–∏—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å.</p>
        <% end %>
      </div>

      <div id="reviews" class="tab-content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
          <h2 style="color: #9b59b6; margin: 0;">‚≠ê –í—ñ–¥–≥—É–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</h2>
          <button onclick="openTab('admin-panel')" class="btn-back">‚¨Ö –ù–∞–∑–∞–¥ –¥–æ –ø–∞–Ω–µ–ª—ñ</button>
        </div>

        <% if @rated_orders && @rated_orders.any? %>
          <table class="data-table">
            <thead>
              <tr>
                <th>‚Ññ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</th>
                <th>–î–∞—Ç–∞ –≤—ñ–¥–≥—É–∫—É</th>
                <th>–ö–ª—ñ—î–Ω—Ç</th>
                <th>–û—Ü—ñ–Ω–∫–∞</th>
                <th>–ö–æ–º–µ–Ω—Ç–∞—Ä</th>
                <th style="text-align: right;">–î—ñ—ó</th>
              </tr>
            </thead>
            <tbody>
              <% @rated_orders.each do |order| %>
                <tr>
                  <td style="font-weight: bold;">#<%= order.id %></td>
                  <td style="color: #666;"><%= order.updated_at.strftime("%d.%m.%Y") %></td>
                  <td>
                    <%= order.user ? "#{order.user.first_name} #{order.user.last_name}" : "–ì—ñ—Å—Ç—å" %><br>
                    <small style="color: #999;"><%= order.phone %></small>
                  </td>
                  <td>
                    <div style="color: #ffc107;">
                       <% order.rating.times do %>‚òÖ<% end %><% (5 - order.rating).times do %>‚òÜ<% end %>
                    </div>
                  </td>
                  <td>
                    <% if order.review.present? %>
                      <div style="max-width: 300px; font-style: italic;">"<%= order.review %>"</div>
                    <% else %>
                      <span style="color: #ccc;">(–±–µ–∑ –∫–æ–º–µ–Ω—Ç–∞—Ä—è)</span>
                    <% end %>
                  </td>
                  <td style="text-align: right;">
                    <%= link_to "–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è", order, style: "color: #007bff; text-decoration: none;" %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        <% else %>
           <div style="padding: 40px; text-align: center; background: white; border-radius: 8px;">
             <p style="font-size: 18px; color: #777;">–©–µ –Ω–µ–º–∞—î –æ—Ü—ñ–Ω–æ–∫ –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ üòî</p>
           </div>
        <% end %>
      </div>

    <% end %>
  
  </div>
</div>

<div id="review-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
  <div style="background: white; padding: 30px; border-radius: 10px; width: 400px; text-align: center; position: relative;">
    <h3 style="margin-top: 0;">–û—Ü—ñ–Ω—ñ—Ç—å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h3>
    
    <%= form_with url: "", method: :patch, id: "review-form", local: true do |f| %>
      
      <div class="star-rating" style="display: flex; flex-direction: row-reverse; justify-content: center; gap: 5px; margin: 20px 0;">
        <% 5.downto(1) do |i| %>
          <input type="radio" id="star<%= i %>" name="rating" value="<%= i %>" style="display: none;" required>
          <label for="star<%= i %>" style="font-size: 30px; color: #ddd; cursor: pointer; transition: 0.2s;">‚òÖ</label>
        <% end %>
      </div>

      <div style="margin-bottom: 20px;">
        <%= f.text_area :review, placeholder: "–ù–∞–ø–∏—à—ñ—Ç—å –≤–∞—à –≤—ñ–¥–≥—É–∫ —Ç—É—Ç...", style: "width: 100%; height: 80px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;" %>
      </div>

      <button type="submit" class="btn-save" style="width: 100%; margin-top: 0;">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤—ñ–¥–≥—É–∫</button>
    <% end %>

    <button onclick="closeReviewModal()" style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 20px; cursor: pointer;">√ó</button>
  </div>
</div>
  
<script>
  function openTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    
    // –Ø–∫—â–æ —Ü–µ "–ø—ñ–¥—Å—Ç–æ—Ä—ñ–Ω–∫–∞" (–§—ñ–Ω–∞–Ω—Å–∏ –∞–±–æ –í—ñ–¥–≥—É–∫–∏), –∞–∫—Ç–∏–≤–Ω–æ—é –ª–∏—à–∞—î–º–æ "–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å"
    if (tabName === 'finance' || tabName === 'reviews') {
        document.getElementById(tabName).classList.add('active');
        document.getElementById('btn-admin-panel').classList.add('active');
    } else {
        document.getElementById(tabName).classList.add('active');
        const btn = document.getElementById('btn-' + tabName);
        if (btn) btn.classList.add('active');
    }
    localStorage.setItem('activeTab', tabName);
  }

  // –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –≤—ñ–¥–≥—É–∫—ñ–≤
  function openReviewModal(orderId) {
    const modal = document.getElementById('review-modal');
    const form = document.getElementById('review-form');
    // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π URL –¥–ª—è —Ñ–æ—Ä–º–∏
    form.action = "/orders/" + orderId + "/add_review";
    modal.style.display = 'flex';
  }

  function closeReviewModal() {
    document.getElementById('review-modal').style.display = 'none';
  }
  
  // –ó–∞–∫—Ä–∏—Ç–∏ –ø—Ä–∏ –∫–ª—ñ–∫—É –∑–∞ –º–µ–∂—ñ –≤—ñ–∫–Ω–∞
  window.onclick = function(event) {
    const modal = document.getElementById('review-modal');
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }

  document.addEventListener("DOMContentLoaded", function() {
    let savedTab = localStorage.getItem('activeTab');
    if (savedTab) openTab(savedTab);
  });
  
  const cityInput = document.getElementById('city-search');
  const citySuggestions = document.getElementById('city-suggestions');
  if (cityInput) {
    let timeout = null;
    cityInput.addEventListener('input', function() {
      const query = cityInput.value;
      clearTimeout(timeout);
      if (query.length < 3) { citySuggestions.style.display = 'none'; return; }
      timeout = setTimeout(() => {
        fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${query}&addressdetails=1&limit=5&accept-language=uk&countrycodes=ua`)
          .then(res => res.json())
          .then(data => {
            citySuggestions.innerHTML = '';
            if (data.length > 0) {
              citySuggestions.style.display = 'block';
              data.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item.display_name;
                li.onclick = function() { cityInput.value = item.display_name; citySuggestions.style.display = 'none'; };
                citySuggestions.appendChild(li);
              });
            } else { citySuggestions.style.display = 'none'; }
          });
      }, 500);
    });
    document.addEventListener('click', e => { if (e.target !== cityInput) citySuggestions.style.display = 'none'; });
  }
</script>